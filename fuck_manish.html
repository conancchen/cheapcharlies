<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- Prevent Safari mobile zoom on double-tap or pinch -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>F Manish Counter</title>
  <link rel="stylesheet" href="css/style.css" />

  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem 1rem;
      background: #87efff;
      font-family: Arial, sans-serif;
      color: #000;
      text-align: center;
      -webkit-user-select: none;
      user-select: none;
      touch-action: manipulation;
    }
    h1 {
      margin-bottom: 0.5rem;
      font-size: 2rem;
      font-weight: bold;
    }
    #instruction {
      margin-bottom: 1rem;
      font-size: 1rem;
      color: #333;
    }
    #counter {
      font-size: 4rem;
      font-weight: bold;
      margin: 1rem 0;
    }
    #manish-img {
      max-width: 60vw;
      max-height: 40vh;
      border: 4px solid #000;
      border-radius: 8px;
      margin-bottom: 1rem;
      cursor: pointer;
      transition: transform 0.1s ease;
      touch-action: manipulation;
    }
    /* Shrink effect on click */
    #manish-img.shrink {
      transform: scale(0.9);
    }
    #messages {
      margin-top: 1rem;
      width: 80vw;
      max-width: 300px;
      text-align: left;
    }
    #messages p {
      background: rgba(255,255,255,0.8);
      padding: 0.5rem;
      border: 1px solid #000;
      border-radius: 4px;
      margin: 0.25rem 0;
      font-size: 0.9rem;
    }
    .site-nav {
      margin-bottom: 2rem;
      touch-action: manipulation;
    }
    .site-nav a {
      color: #000;
      text-decoration: none;
      font-weight: bold;
      margin: 0 0.5rem;
      padding: 0.25rem 0.5rem;
      border-radius: 8px;
      transition: background-color 0.2s;
      touch-action: manipulation;
    }
    .site-nav a:hover { background-color: rgba(0,0,0,0.1); }
  </style>
</head>
<body>
  <nav class="site-nav">
    <a href="index.html">Cheap Charlies Compass</a>
  </nav>

  <h1>F Manish Counter</h1>
  <p id="instruction">Click the picture to F Manish</p>

  <div id="counter"></div>
  <img id="manish-img" src="images/manish.jpg" alt="Manish">

  <!-- Messages: appear once thresholds reached -->
  <div id="messages"></div>

  <script>
    const API = 'https://script.google.com/macros/s/AKfycbwqF0QBTXnAmZMh43jmxxKp9emTYJw8iQPGctAbvedN7mzy2_qvK0S4TyCw73Y11r8tsw/exec';
    const counterEl = document.getElementById('counter');
    const img       = document.getElementById('manish-img');
    const messagesContainer = document.getElementById('messages');
    let currentCount = null;

    // Define thresholds and custom messages (10 total)
    const thresholds = Array.from({length: 10}, (_, i) => (i + 1) * 25);
    const messageList = [
      'Goodmorning',
      'Need any support from me?',
      'Do you want some massage parlor recs?',
      'Is that ladyboy fucking you in the ass?',
      'It is all about exposure, going to events man. Learning about different industries.',
      'Mike Tyson is coming to Bangkok and I am doing his security',
      'Oh you have the shits? BPHRLLLLL BPRHLLL (on the BTS btw)',
      'Tell me tell me. I am your friend',
      'I used to host the biggest Bollywood parties in London',
      '250 clicks! If you made it here you must really wanna F manish.'
    ];

    // Render messages based on count
    function updateMessages() {
      messagesContainer.innerHTML = '';
      thresholds.forEach((t, i) => {
        if (currentCount >= t) {
          const p = document.createElement('p');
          p.textContent = messageList[i];
          messagesContainer.appendChild(p);
        }
      });
    }

    // Show loading until fetched
    counterEl.textContent = 'Loading…';

    // Fetch initial count
    fetch(API)
      .then(r => r.json())
      .then(data => {
        currentCount = data.count || 0;
        counterEl.textContent = currentCount;
        updateMessages();
      })
      .catch(() => {
        currentCount = 0;
        counterEl.textContent = '0';
        updateMessages();
      });

    // Increment logic with shrink, haptic, messages update
    function incrementCounter() {
      if (currentCount === null) return;
      img.classList.add('shrink');
      setTimeout(() => img.classList.remove('shrink'), 100);
      navigator.vibrate?.(50);
      currentCount++;
      counterEl.textContent = currentCount;
      updateMessages();
      fetch(API, { method: 'POST' })
        .then(r => r.json())
        .then(data => {
          if (data.count >= currentCount) {
            currentCount = data.count;
            counterEl.textContent = currentCount;
            updateMessages();
          }
        });
    }

    img.addEventListener('click', incrementCounter);
    document.addEventListener('keydown', e => {
      if (e.code === 'Space') {
        e.preventDefault();
        incrementCounter();
      }
    });

    // Poll every 5s and update messages
    setInterval(() => {
      if (currentCount === null) return;
      fetch(API)
        .then(r => r.json())
        .then(data => {
          if (data.count > currentCount) {
            currentCount = data.count;
            counterEl.textContent = currentCount;
            updateMessages();
          }
        });
    }, 5000);
  </script>
</body>
</html>
